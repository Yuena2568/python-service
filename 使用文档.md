# Pythonç”¨æˆ·æœåŠ¡API - å®Œæ•´ä½¿ç”¨æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: python-service ç”¨æˆ·æœåŠ¡API  
**ç‰ˆæœ¬**: 1.0.0  
**æŠ€æœ¯æ ˆ**: FastAPI + MySQL + JWT  
**å¼€å‘è¯­è¨€**: Python 3.13  

### ä¸»è¦åŠŸèƒ½
- âœ… ç”¨æˆ·æ³¨å†Œï¼ˆç”¨æˆ·å + é‚®ç®±ï¼‰
- âœ… ç”¨æˆ·ç™»å½•ï¼ˆJWTä»¤ç‰Œè®¤è¯ï¼‰
- âœ… å¯†ç å®‰å…¨åŠ å¯†å­˜å‚¨
- âœ… è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£
- âœ… æ•°æ®åº“ç”¨æˆ·ç®¡ç†

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚
- **Python**: 3.8+ï¼ˆæ¨è3.13ï¼‰
- **MySQL**: 5.7+ï¼ˆæ¨è8.0ï¼‰
- **æ“ä½œç³»ç»Ÿ**: Windows 10/11

### 2. å®‰è£…æ­¥éª¤

#### æ­¥éª¤1ï¼šæ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd d:\æ–°å»ºæ–‡ä»¶å¤¹\python-service

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
python-service\Scripts\activate
```

#### æ­¥éª¤2ï¼šå¯åŠ¨MySQLæœåŠ¡
ç¡®ä¿MySQLæœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆMySQL80æœåŠ¡çŠ¶æ€ä¸º"æ­£åœ¨è¿è¡Œ"ï¼‰

#### æ­¥éª¤3ï¼šå¯åŠ¨APIæœåŠ¡
```bash
# å¯åŠ¨FastAPIæœåŠ¡
python -m app.main
```

æœåŠ¡å¯åŠ¨åå°†åœ¨ **http://localhost:8000** è¿è¡Œ

---

## ğŸ“– APIæ¥å£æ–‡æ¡£

### è®¿é—®æ–¹å¼
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc  
- **OpenAPI JSON**: http://localhost:8000/openapi.json

### ä¸»è¦æ¥å£

#### 1. å¥åº·æ£€æŸ¥
```
GET /
GET /health
```
ç”¨äºæ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€

#### 2. ç”¨æˆ·æ³¨å†Œ
```
POST /api/v1/auth/register
```

**è¯·æ±‚ä½“**:
```json
{
  "username": "ç”¨æˆ·å",
  "email": "é‚®ç®±@example.com",
  "password": "å¯†ç 123"
}
```

**å‚æ•°è¦æ±‚**:
- `username`: 3-50ä¸ªå­—ç¬¦ï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼Œå¿…é¡»å”¯ä¸€
- `email`: æ ‡å‡†é‚®ç®±æ ¼å¼ï¼Œå¿…é¡»å”¯ä¸€
- `password`: è‡³å°‘8ä½ï¼Œå¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "ç”¨æˆ·æ³¨å†ŒæˆåŠŸ",
  "data": {
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com",
      "is_active": true,
      "created_at": "2025-08-25T10:00:00"
    },
    "user_id": 1
  }
}
```

#### 3. ç”¨æˆ·ç™»å½•
```
POST /api/v1/auth/login
```

**è¯·æ±‚ä½“**:
```json
{
  "username": "ç”¨æˆ·å",
  "password": "å¯†ç 123"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "token_type": "bearer",
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com",
      "is_active": true,
      "created_at": "2025-08-25T10:00:00",
      "last_login": "2025-08-25T10:30:00"
    }
  }
}
```

---

## ğŸ› ï¸ ä½¿ç”¨å·¥å…·è„šæœ¬

### 1. ç”¨æˆ·æ³¨å†Œå·¥å…·

#### ç®€å•æ³¨å†Œè„šæœ¬
```bash
python simple_register.py
```
**åŠŸèƒ½**: äº¤äº’å¼ç”¨æˆ·æ³¨å†Œï¼ŒåŒ…å«è¾“å…¥éªŒè¯å’Œç¡®è®¤

#### æ³¨å†Œæ¼”ç¤ºè„šæœ¬  
```bash
python register_demo.py
```
**åŠŸèƒ½**: å¤šç§æ³¨å†Œé€‰é¡¹ï¼Œæ”¯æŒæ¼”ç¤ºç”¨æˆ·å’Œè‡ªå®šä¹‰ç”¨æˆ·

### 2. æ•°æ®åº“æŸ¥çœ‹å·¥å…·

#### å¿«é€ŸæŸ¥çœ‹ç”¨æˆ·
```bash
python quick_view.py
```
é€‰é¡¹ï¼š
- `1`: æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·è¯¦æƒ…
- `2`: æŸ¥çœ‹ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯

#### è¯¦ç»†ç”¨æˆ·ç®¡ç†
```bash
python view_users.py
```
åŠŸèƒ½ï¼š
- æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨
- æ ¹æ®IDæŸ¥æ‰¾ç”¨æˆ·
- æ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾ç”¨æˆ·
- æ˜¾ç¤ºç”¨æˆ·è¯¦ç»†ä¿¡æ¯

### 3. ç³»ç»Ÿæ£€æŸ¥å·¥å…·

#### MySQLå®‰è£…æ£€æŸ¥
```bash
python mysql_setup_guide.py
```
**åŠŸèƒ½**: æ£€æŸ¥MySQLå®‰è£…çŠ¶æ€ï¼Œæä¾›å®‰è£…æŒ‡å¯¼

#### MySQLè¿æ¥æµ‹è¯•
```bash
python check_mysql.py
```
**åŠŸèƒ½**: éªŒè¯æ•°æ®åº“è¿æ¥å’Œé…ç½®

### 4. æ•°æ®åº“ç®¡ç†

#### åˆå§‹åŒ–æ•°æ®åº“
```bash
python init_db.py
```
**åŠŸèƒ½**: åˆ›å»ºuser_serviceæ•°æ®åº“å’Œusersè¡¨

---

## ğŸ“± å®¢æˆ·ç«¯ä½¿ç”¨ç¤ºä¾‹

### PowerShellç¤ºä¾‹

#### ç”¨æˆ·æ³¨å†Œ
```powershell
$registerData = @{
    username="newuser"
    email="newuser@example.com"
    password="password123"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8000/api/v1/auth/register" -Method Post -Body $registerData -ContentType "application/json"
```

#### ç”¨æˆ·ç™»å½•
```powershell
$loginData = @{
    username="newuser"
    password="password123"
} | ConvertTo-Json

$response = Invoke-RestMethod -Uri "http://localhost:8000/api/v1/auth/login" -Method Post -Body $loginData -ContentType "application/json"
$token = $response.data.access_token
```

### Python requestsç¤ºä¾‹

```python
import requests

# ç”¨æˆ·æ³¨å†Œ
register_data = {
    "username": "pythonuser",
    "email": "python@example.com",
    "password": "python123"
}

response = requests.post(
    "http://localhost:8000/api/v1/auth/register",
    json=register_data
)
print("æ³¨å†Œç»“æœ:", response.json())

# ç”¨æˆ·ç™»å½•
login_data = {
    "username": "pythonuser",
    "password": "python123"
}

response = requests.post(
    "http://localhost:8000/api/v1/auth/login",
    json=login_data
)

if response.status_code == 200:
    result = response.json()
    token = result["data"]["access_token"]
    print("ç™»å½•æˆåŠŸï¼Œä»¤ç‰Œ:", token[:50] + "...")
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒé…ç½®æ–‡ä»¶ (.env)
```env
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=123456
DB_NAME=user_service

# JWTé…ç½®
SECRET_KEY=09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# åº”ç”¨é…ç½®
APP_NAME=ç”¨æˆ·æœåŠ¡API
APP_VERSION=1.0.0
DEBUG=True
```

### æ•°æ®åº“é…ç½®ä¿®æ”¹

å¦‚æœéœ€è¦ä¿®æ”¹æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼š

1. **ä¿®æ”¹ .env æ–‡ä»¶**ä¸­çš„æ•°æ®åº“å‚æ•°
2. **é‡å¯APIæœåŠ¡**ä½¿é…ç½®ç”Ÿæ•ˆ

### JWTä»¤ç‰Œé…ç½®

- **è¿‡æœŸæ—¶é—´**: é»˜è®¤30åˆ†é’Ÿ
- **ç®—æ³•**: HS256
- **å¯†é’¥**: ç”Ÿäº§ç¯å¢ƒè¯·æ›´æ¢ä¸ºå¤æ‚å¯†é’¥

---

## ğŸ—„ï¸ æ•°æ®åº“ä¿¡æ¯

### æ•°æ®åº“ç»“æ„
```sql
-- æ•°æ®åº“åç§°
user_service

-- ç”¨æˆ·è¡¨ç»“æ„
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç”¨æˆ·å”¯ä¸€æ ‡è¯†',
    username VARCHAR(50) UNIQUE NOT NULL COMMENT 'ç”¨æˆ·å',
    email VARCHAR(100) UNIQUE NOT NULL COMMENT 'é‚®ç®±åœ°å€',
    hashed_password VARCHAR(255) NOT NULL COMMENT 'åŠ å¯†åçš„å¯†ç ',
    is_active BOOLEAN DEFAULT TRUE COMMENT 'ç”¨æˆ·çŠ¶æ€',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    last_login DATETIME NULL COMMENT 'æœ€åç™»å½•æ—¶é—´'
);
```

### æŸ¥çœ‹æ•°æ®åº“å†…å®¹

#### ä½¿ç”¨è„šæœ¬æŸ¥çœ‹
```bash
# å¿«é€ŸæŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
python quick_view.py

# è¯¦ç»†ç”¨æˆ·ç®¡ç†
python view_users.py
```

#### ä½¿ç”¨SQLæŸ¥è¯¢
```sql
-- è¿æ¥æ•°æ®åº“
USE user_service;

-- æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
SELECT id, username, email, is_active, created_at, last_login FROM users;

-- æŸ¥çœ‹ç”¨æˆ·ç»Ÿè®¡
SELECT COUNT(*) as total_users FROM users;
SELECT COUNT(*) as active_users FROM users WHERE is_active = TRUE;
```

---

## ğŸ“Š Apifoxé›†æˆæŒ‡å—

### 1. å¯¼å…¥APIæ–‡æ¡£
1. åœ¨Apifoxä¸­åˆ›å»ºæ–°é¡¹ç›®
2. é€‰æ‹©"å¯¼å…¥æ•°æ®"
3. è¾“å…¥URL: `http://localhost:8000/openapi.json`
4. ç‚¹å‡»"å¯¼å…¥"

### 2. æµ‹è¯•æ¥å£

#### ç”¨æˆ·æ³¨å†Œæµ‹è¯•
- **æ¥å£**: POST `/api/v1/auth/register`
- **æµ‹è¯•æ•°æ®**:
  ```json
  {
    "username": "apifox_user",
    "email": "apifox@example.com",
    "password": "apifox123"
  }
  ```

#### ç”¨æˆ·ç™»å½•æµ‹è¯•
- **æ¥å£**: POST `/api/v1/auth/login`
- **æµ‹è¯•æ•°æ®**:
  ```json
  {
    "username": "apifox_user",
    "password": "apifox123"
  }
  ```

### 3. ç¯å¢ƒå˜é‡é…ç½®
åœ¨Apifoxä¸­è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
- `base_url`: `http://localhost:8000`
- `api_prefix`: `/api/v1`

---

## â— å¸¸è§é—®é¢˜ä¸è§£å†³

### 1. MySQLè¿æ¥å¤±è´¥
**é”™è¯¯**: `Can't connect to MySQL server on 'localhost'`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
python check_mysql.py

# 2. å¯åŠ¨MySQLæœåŠ¡
# æ–¹æ³•1ï¼šæœåŠ¡ç®¡ç†å™¨
# Win+R â†’ services.msc â†’ æ‰¾åˆ°MySQL80 â†’ å¯åŠ¨

# æ–¹æ³•2ï¼šå‘½ä»¤è¡Œ
net start MySQL
```

### 2. å¯†ç éªŒè¯å¤±è´¥
**é”™è¯¯**: `å¯†ç å¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—`

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿å¯†ç è‡³å°‘8ä½
- å¯†ç å¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—
- ç¤ºä¾‹æœ‰æ•ˆå¯†ç : `password123`, `user2024`, `abc12345`

### 3. ç”¨æˆ·åæˆ–é‚®ç®±å·²å­˜åœ¨
**é”™è¯¯**: `ç”¨æˆ·åå·²å­˜åœ¨` æˆ– `é‚®ç®±å·²è¢«æ³¨å†Œ`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥çœ‹ç°æœ‰ç”¨æˆ·
python quick_view.py

# ä½¿ç”¨ä¸åŒçš„ç”¨æˆ·åå’Œé‚®ç®±æ³¨å†Œ
python simple_register.py
```

### 4. APIæœåŠ¡æ— æ³•å¯åŠ¨
**é”™è¯¯**: `Address already in use`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr :8000

# ç»ˆæ­¢å ç”¨è¿›ç¨‹
taskkill /PID <è¿›ç¨‹ID> /F

# æˆ–è€…æ›´æ”¹ç«¯å£ï¼ˆåœ¨app/main.pyä¸­ä¿®æ”¹ï¼‰
```

### 5. è™šæ‹Ÿç¯å¢ƒé—®é¢˜
**é”™è¯¯**: æ‰¾ä¸åˆ°æ¨¡å—

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ç¡®ä¿æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
python-service\Scripts\activate

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

---

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

### 1. å¯†ç å®‰å…¨
- âœ… å¯†ç ä½¿ç”¨bcryptç®—æ³•åŠ å¯†å­˜å‚¨
- âœ… æ•°æ®åº“ä¸­ä¸å­˜å‚¨æ˜æ–‡å¯†ç 
- âœ… å¯†ç éªŒè¯ä¸¥æ ¼æŒ‰ç…§è§„åˆ™æ‰§è¡Œ

### 2. JWTä»¤ç‰Œå®‰å…¨
- âœ… ä½¿ç”¨HS256ç®—æ³•ç­¾å
- âœ… ä»¤ç‰Œæœ‰30åˆ†é’Ÿè¿‡æœŸæ—¶é—´
- â— ç”Ÿäº§ç¯å¢ƒéœ€æ›´æ¢å¤æ‚çš„SECRET_KEY

### 3. æ•°æ®åº“å®‰å…¨
- âœ… ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢SQLæ³¨å…¥
- âœ… æ•°æ®åº“è¿æ¥ä½¿ç”¨åŠ å¯†ä¼ è¾“
- â— ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ä¸“ç”¨æ•°æ®åº“ç”¨æˆ·

---

## ğŸ“š é¡¹ç›®æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶
| æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½è¯´æ˜ |
|---------|---------|
| `app/main.py` | FastAPIä¸»åº”ç”¨ï¼Œè·¯ç”±é…ç½® |
| `app/auth.py` | è®¤è¯ç›¸å…³APIæ¥å£ |
| `app/database.py` | æ•°æ®åº“æ¨¡å‹å’Œè¿æ¥ç®¡ç† |
| `app/config.py` | åº”ç”¨é…ç½®ç®¡ç† |
| `app/schemas.py` | æ•°æ®éªŒè¯æ¨¡å‹ |
| `app/security.py` | å®‰å…¨è®¤è¯åŠŸèƒ½ |
| `app/crud.py` | æ•°æ®åº“æ“ä½œå‡½æ•° |

### å·¥å…·è„šæœ¬
| æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½è¯´æ˜ |
|---------|---------|
| `simple_register.py` | ç®€å•ç”¨æˆ·æ³¨å†Œå·¥å…· |
| `register_demo.py` | æ³¨å†Œæ¼”ç¤ºå·¥å…· |
| `quick_view.py` | å¿«é€ŸæŸ¥çœ‹ç”¨æˆ· |
| `view_users.py` | è¯¦ç»†ç”¨æˆ·ç®¡ç† |
| `check_mysql.py` | MySQLè¿æ¥æ£€æŸ¥ |
| `mysql_setup_guide.py` | MySQLå®‰è£…æŒ‡å¯¼ |
| `init_db.py` | æ•°æ®åº“åˆå§‹åŒ– |

### é…ç½®æ–‡ä»¶
| æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½è¯´æ˜ |
|---------|---------|
| `.env` | ç¯å¢ƒå˜é‡é…ç½® |
| `requirements.txt` | Pythonä¾èµ–åŒ…åˆ—è¡¨ |
| `README.md` | é¡¹ç›®è¯´æ˜æ–‡æ¡£ |

---

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 1. ç¯å¢ƒå˜é‡é…ç½®
```env
# ç”Ÿäº§ç¯å¢ƒé…ç½®ç¤ºä¾‹
DB_HOST=your-production-db-host
DB_PORT=3306
DB_USER=your-db-user
DB_PASSWORD=your-strong-password
DB_NAME=user_service

SECRET_KEY=your-super-secret-key-256-bits-long
ACCESS_TOKEN_EXPIRE_MINUTES=60
DEBUG=False
```

### 2. ä½¿ç”¨Gunicornéƒ¨ç½²
```bash
# å®‰è£…Gunicorn
pip install gunicorn

# å¯åŠ¨ç”Ÿäº§æœåŠ¡
gunicorn app.main:app -w 4 -k uvicorn.workers.UvicornWorker -b 0.0.0.0:8000
```

### 3. ä½¿ç”¨Dockeréƒ¨ç½²
```dockerfile
FROM python:3.13-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
EXPOSE 8000

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¼€å‘ç¯å¢ƒä¿¡æ¯
- **Pythonç‰ˆæœ¬**: 3.13
- **FastAPIç‰ˆæœ¬**: 0.116.1
- **MySQLç‰ˆæœ¬**: 8.0+
- **å¼€å‘å·¥å…·**: Qoder IDE

### æ—¥å¿—æŸ¥çœ‹
APIæœåŠ¡è¿è¡Œæ—¶ä¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼ŒåŒ…æ‹¬ï¼š
- æ•°æ®åº“è¿æ¥çŠ¶æ€
- APIè¯·æ±‚å“åº”
- é”™è¯¯ä¿¡æ¯å’Œå †æ ˆè·Ÿè¸ª

### æ€§èƒ½ç›‘æ§
- å¥åº·æ£€æŸ¥æ¥å£: `GET /health`
- æ•°æ®åº“è¿æ¥ç›‘æ§
- JWTä»¤ç‰ŒéªŒè¯æ€§èƒ½

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-08-25)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½
- âœ… ç”¨æˆ·ç™»å½•åŠŸèƒ½
- âœ… JWTä»¤ç‰Œè®¤è¯
- âœ… MySQLæ•°æ®åº“é›†æˆ
- âœ… APIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
- âœ… å®Œæ•´çš„å·¥å…·è„šæœ¬é›†

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦æƒ…è¯·å‚é˜… LICENSE æ–‡ä»¶ã€‚

---

**ğŸ“§ è”ç³»ä¿¡æ¯**: å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡é¡¹ç›®Issuesæäº¤åé¦ˆã€‚

**ğŸŒŸ é¡¹ç›®åœ°å€**: æœ¬åœ°å¼€å‘é¡¹ç›®

**ğŸ“± åœ¨çº¿æ–‡æ¡£**: http://localhost:8000/docs